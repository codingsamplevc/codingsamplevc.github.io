<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <title>My page</title>
  <script>
    ////////////////////////
    // JavaScript example 1
    let playerTurn = 1;
    const players = ['O','X'];
    const cell_id_prefix = 'ttt';

    function getCellValue(id){
      return document.getElementById(id).innerHTML;
    }
    
    function checkWinCondition(player){
      
      let diagL = 0;
      let diagR = 0;
      for (let k = 0; k < 3; k++){
        if (getCellValue(`${cell_id_prefix}_${k}_${k}`) == player){
          diagL++;
        }
        if (getCellValue(`${cell_id_prefix}_${k}_${2 - k}`) == player){
          diagR++;
        }
      }
      
      if (diagL == 3 || diagR == 3){
        return true;
      }
      
      
      let horiz = 0;
      let vert = 0;
      for (let i = 0; i < 3; i++){
        for (let j = 0; j < 3; j++){
          if (getCellValue(`${cell_id_prefix}_${i}_${j}`) == player){
            horiz++;
          }
          if (getCellValue(`${cell_id_prefix}_${j}_${i}`) == player){
            vert++;
          }
        }
        
        if (horiz == 3 || vert == 3){
          return true;
        }
        horiz = 0;
        vert = 0;
      }
      
      return false;
    }
    
    function getPlayerTurn(){
      return players[playerTurn % 2];
    }

    function advancePlayerTurn(){
      playerTurn++;
    }

    function resetPlayerTurn(){
      playerTurn = 1;
    }
    
    function chooseCell(){
      if (!document.getElementById("ttt_game_status").innerHTML && this.innerHTML == ' '){
        this.innerHTML = getPlayerTurn();
        const curPlayer = getPlayerTurn();
        if (playerTurn > 4 && checkWinCondition(curPlayer)){
          const gameStatusEl = document.getElementById("ttt_game_status");
          gameStatusEl.innerHTML = `Player ${curPlayer} won!`;
        }
        advancePlayerTurn();
      } else {
        
      }
    }

    
    function createTicTacToeTable(el_id){
      // Function that creates an HTML table that can be used to play TicTacToe
        
      function returnTableCell(id){
        const tCell = document.createElement("td");
        tCell.id = id;
        tCell.onclick = chooseCell;
        tCell.innerHTML = ' ';
        return tCell;
      }
      
      
      function returnTableRow(i){
        const tRow = document.createElement("tr");
        for (let j = 0; j < 3; j++){
          tRow.appendChild(returnTableCell(`${cell_id_prefix}_${i}_${j}`));
        }
        return tRow;
      }
      
      const tableId = "tttTable";
      if (!document.getElementById(tableId)){
        const tableEl = document.createElement("table");
        tableEl.id = tableId;
        
        for (let i = 0; i < 3; i++){
          const tRow = returnTableRow(i);
          tableEl.appendChild(tRow);
        }
        
        const tableContainer = document.getElementById(el_id);
        tableContainer.appendChild(tableEl);

        const gameStatusEl = document.createElement("p");
        gameStatusEl.id = "ttt_game_status";
        tableContainer.appendChild(gameStatusEl);
      }
    }
    
    function resetTicTacToe(el_id){
      if (!document.getElementById(el_id)) { return; }
      for (let i = 0; i < 3; i++){
        for (let j = 0; j < 3; j++){
          const cell = document.getElementById(`${cell_id_prefix}_${i}_${j}`);
          cell.innerHTML = ' ';
        }
      }
      resetPlayerTurn();
      const gameStatusEl = document.getElementById("ttt_game_status");
      gameStatusEl.innerHTML = '';
    }
  </script>
  <script>
    //////////////////////////
    // JavaScript example 2

    function convertIntoRules(rules_obj){
      let rules_code = `_ {\n`;
      for (const prop in rules_obj){
        if (rules_obj[prop]){
          rules_code += `${prop}: ${rules_obj[prop]};\n`;
        }
      }
      rules_code += `}`;
      return rules_code;
    }

    function modifyInlineStyleOfElement(el_id, changes, removes){
      const el = document.getElementById(el_id);
      const elStyle = el.style;

      if (Object.keys(changes).length > 0){
        for (const prop in changes){
          elStyle.setProperty(prop, changes[prop]);
        }
        const rules = convertIntoRules(changes);
        const codeblock = document.getElementById("css_rules");
        codeblock.innerHTML = rules;
      }

      if (Object.keys(removes).length > 0){
        for (const prop of removes){
          elStyle.removeProperty(prop);
        }
      }
    }

    function handleCSSFormChange(){
      const form = document.getElementById("css_form");
      
      const formData = new FormData(form);
      const formData_entries = formData.entries();

      const changes_obj = {};
      for (let kv of formData_entries){
        if (kv[0] == "font-size"){
          if (parseInt(kv[1]) > 0){
            changes_obj[kv[0]] = `${parseInt(kv[1])}px`;
          }
        } else {
          changes_obj[kv[0]] = kv[1];
        }
      }
      const removes_obj = {};
      modifyInlineStyleOfElement("css_style", changes_obj, removes_obj);
    }

    function setup_css_form(el_id){

      if (document.getElementById("css_form")){ return; }
      
      const form = document.createElement("form");
      form.id = "css_form";
      const rules = [
        [{desc: "Text color", name: "color", type: "color"}, {}],
        [{desc: "Font size", name: "font-size", type: "number"}, {min: 6, max: 50, value: 16}],
        [{desc: "Font (family)", name: "font-family", type: "text"}, {"font-family": ''}]
      ];

      for (const rule of rules){
        const label = document.createElement("label");
        label.setAttribute("for", rule[0].name);
        label.innerHTML = rule[0].desc;
        form.appendChild(label);
        
        const input = document.createElement("input");
        input.name = rule[0].name;
        input.type = rule[0].type;
        
        if (Object.keys(rule[1]).length > 0){
          for (const a in rule[1]){
            input[a] = rule[1][a];
          }
        }
        form.appendChild(input);
      }

      const container = document.getElementById(el_id);
      container.appendChild(form);

      const br_tag = document.createElement("br");
      container.appendChild(br_tag);

      const change_style_btn = document.createElement("button");
      change_style_btn.id = "css_submit";
      change_style_btn.innerHTML = "Change style";
      container.appendChild(change_style_btn);
      change_style_btn.addEventListener("click", handleCSSFormChange);

      const code_desc = document.createElement("p");
      code_desc.innerHTML = "Below are the rules for the CSS styles";
      container.appendChild(code_desc);

      const code_block = document.createElement("code");
      code_block.id = "css_rules";
      container.appendChild(code_block);
    }
  </script>
  <script>
    ////////////////////////
    // JavaScript example 3

    const game_state = {};
    const height = 25;
    const width = 25;
    
    function getAdjacent(x_idx, y_idx, x_idx_max, y_idx_max){
      if (x_idx_max != 0 && y_idx_max != 0){
        const adjacent = [];
        const x = [x_idx];
        const y = [y_idx];
        if (x_idx > 0){
          x.push(x_idx - 1);
        }
        if (x_idx < x_idx_max){
          x.push(x_idx + 1);
        }
        if (y_idx > 0){
          y.push(y_idx - 1);
        }
        if (y_idx < y_idx_max){
          y.push(y_idx + 1);
        }

        for (const x_coord of x){
          for (const y_coord of y){
            if (x_coord != x_idx || y_coord != y_idx){
              adjacent.push(`${x_coord}_${y_coord}`);
            }
          }
        }

        return adjacent;
      }
    }
    
    function checkAdjacent(adjacent){
      let alive = 0;
      for (const cell_id of adjacent){
        if (game_state[cell_id]){
          alive++;
        }
      }
      return alive;
    }

    function isAlive(currently_alive, adjacent_number){
      if (currently_alive){ return (adjacent_number > 1 && adjacent_number < 4); }
      else { return adjacent_number == 3; }
    }
    
    function advanceGOL(){
      const cellsToChange = [];
      for (const cell in game_state){
        const cell_coords = cell.split('_');
        if (game_state[cell] != isAlive(game_state[cell], checkAdjacent(getAdjacent(parseInt(cell_coords[0]), parseInt(cell_coords[1]), height - 1, width - 1)))){
          cellsToChange.push(cell);
        }
      }
      for (const cell of cellsToChange){
        game_state[cell] = !(game_state[cell]);
        const cell_el = document.getElementById(cell);
        if (cell_el.className == 'alive'){
          cell_el.className = 'dead';
        } else {
          cell_el.className = 'alive';
        }
      }
    }

    function changeCell(cell_id){
      game_state[cell_id] = !(game_state[cell_id]);
      const cell = document.getElementById(cell_id);
      if (cell.className == "alive"){
        cell.className = "dead";
      } else {
        cell.className = "alive";
      }
    }

    function handleCellClick(e){
      console.log("clicked " + e.target.id);
      changeCell(e.target.id);
    }

    function createBoard(el_id){
      if (document.getElementById("gol_board")){ return; }
      
      const board = document.createElement("table");
      board.id = "gol_board";
      
      for (let i = 0; i < height; i++){
        let row = document.createElement("tr");
        for (let j = 0; j < width; j++){
          let cell = document.createElement("td");
          cell.id = `${i}_${j}`;
          cell.className = "dead";
          row.appendChild(cell);
          cell.addEventListener("click", handleCellClick);
          game_state[`${i}_${j}`] = 0;
        }
        board.appendChild(row);
      }
      const container = document.getElementById(el_id);
      container.appendChild(board);

      const advance_btn = document.createElement("button");
      advance_btn.innerHTML = "Advance";
      advance_btn.addEventListener("click", advanceGOL);
      container.appendChild(advance_btn);
    }
    
  </script>
</head>
<body>
  <h1>JavaScript Examples</h1>
  <p>A few JavaScript examples</p>
  <hr />
  <div id="js_1">
    <button type="button" onclick="createTicTacToeTable('js_1')">Create table</button>
    <button type="button" onclick="resetTicTacToe('tttTable')">Reset table</button>
    <!-- JavaScript example 1: TicTacToe game -->
    <p>TicTacToe board</p>
  </div>
  <hr />
  <div id="js_2">
    <button onclick="setup_css_form('js_2')">Setup CSS-form</button>
    <!-- JavaScript example 2: Interactive CSS -->
    <p>Interactive CSS style form</p>
    <p id="css_style">Change the appearance of this text through a form.</p>
  </div>
  <hr />
  <div id="js_3">
    <p>Conway's 'Game Of Life'</p>
    <button onclick="createBoard('js_3')">Create 'Game Of Life' board</button>
  </div>
</body>
</html>
