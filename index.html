<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <title>My page</title>
  <script>
    ////////////////////////
    // JavaScript example 1
    let playerTurn = 1;
    const players = ['O','X'];
    const cell_id_prefix = 'cell';

    function getCellValue(id){
      return document.getElementById(id).innerHTML;
    }
    
    function checkWinCondition(player){
      
      let diagL = 0;
      let diagR = 0;
      for (let k = 0; k < 3; k++){
        if (getCellValue(`${cell_id_prefix}_${k}_${k}`) == player){
          diagL++;
        }
        if (getCellValue(`${cell_id_prefix}_${k}_${2 - k}`) == player){
          diagR++;
        }
      }
      
      if (diagL == 3 || diagR == 3){
        return true;
      }
      
      
      let horiz = 0;
      let vert = 0;
      for (let i = 0; i < 3; i++){
        for (let j = 0; j < 3; j++){
          if (getCellValue(`${cell_id_prefix}_${i}_${j}`) == player){
            horiz++;
          }
          if (getCellValue(`${cell_id_prefix}_${j}_${i}`) == player){
            vert++;
          }
        }
        
        if (horiz == 3 || vert == 3){
          return true;
        }
        horiz = 0;
        vert = 0;
      }
      
      return false;
    }
    
    function getPlayerTurn(){
      return players[playerTurn % 2];
    }

    function advancePlayerTurn(){
      playerTurn++;
    }

    function resetPlayerTurn(){
      playerTurn = 1;
    }
    
    function chooseCell(){
      if (!document.getElementById("ttt_game_status").innerHTML && this.innerHTML == ' '){
        this.innerHTML = getPlayerTurn();
        const curPlayer = getPlayerTurn();
        if (playerTurn > 4 && checkWinCondition(curPlayer)){
          const gameStatusEl = document.getElementById("ttt_game_status");
          gameStatusEl.innerHTML = `Player ${curPlayer} won!`;
        }
        advancePlayerTurn();
      } else {
        
      }
    }

    
    function createTicTacToeTable(el_id){
      // Function that creates an HTML table that can be used to play TicTacToe
        
      function returnTableCell(id){
        const tCell = document.createElement("td");
        tCell.id = id;
        tCell.onclick = chooseCell;
        tCell.innerHTML = ' ';
        return tCell;
      }
      
      
      function returnTableRow(i){
        const tRow = document.createElement("tr");
        for (let j = 0; j < 3; j++){
          tRow.appendChild(returnTableCell(`${cell_id_prefix}_${i}_${j}`));
        }
        return tRow;
      }
      
      const tableId = "tttTable";
      if (!document.getElementById(tableId)){
        const tableEl = document.createElement("table");
        tableEl.id = tableId;
        
        for (let i = 0; i < 3; i++){
          const tRow = returnTableRow(i);
          tableEl.appendChild(tRow);
        }
        
        const tableContainer = document.getElementById(el_id);
        tableContainer.appendChild(tableEl);

        const gameStatusEl = document.createElement("p");
        gameStatusEl.id = "ttt_game_status";
        tableContainer.appendChild(gameStatusEl);
      }
    }
    
    function resetTicTacToe(el_id){
      if (!document.getElementById("tttTable")) { return; }
      for (let i = 0; i < 3; i++){
        for (let j = 0; j < 3; j++){
          const cell = document.getElementById(`${cell_id_prefix}_${i}_${j}`);
          cell.innerHTML = ' ';
        }
      }
      resetPlayerTurn();
      const gameStatusEl = document.getElementById("ttt_game_status");
      gameStatusEl.innerHTML = '';
    }
  </script>
  <script>
    //////////////////////////
    // JavaScript example 2
    
    // const css_form = document.getElementById("css_form");
    function modifyInlineStyleOfElement(el_id, changes, removes){
      const el = document.getElementById(el_id);
      const elStyle = el.style;

      if (Object.keys(changes).length > 0){
        for (const prop in changes){
          elStyle.setProperty(prop, changes[prop]);
        }
        const rules = convertIntoRules(changes);
        const codeblock = document.getElementById("css_rules");
        codeblock.innerHTML = rules;
      }

      if (Object.keys(removes).length > 0){
        for (const prop of removes){
          elStyle.removeProperty(prop);
        }
      }
    }

    function handleCSSFormChange(){
      // const form = event.target;
      const form = document.getElementById("css_form");
      
      const formData = new FormData(form);
      const formData_entries = formData.entries();
      // console.log(formData_entries);
      // for (let kv of formData_entries){
      //   console.log(kv);
      // }

      const changes_obj = {};
      for (let kv of formData_entries){
        if (kv[0] == "font-size"){
          // changes_obj[kv[0]] = new Number(kv[1]);
          if (parseInt(kv[1]) > 0){
            changes_obj[kv[0]] = `${parseInt(kv[1])}px`;
          }
        } else {
          changes_obj[kv[0]] = kv[1];
        }
      }
      const removes_obj = {};
      modifyInlineStyleOfElement("css_style", changes_obj, removes_obj);
    }

    function setup_css_form(){
      const cssButton = document.getElementById("css_submit");
      cssButton.addEventListener("click", handleCSSFormChange);
    }

    
    function convertIntoRules(rules_obj){
      let rules_code = `_ {\n`;
      for (const prop in rules_obj){
        if (rules_obj[prop]){
          rules_code += `${prop}: ${rules_obj[prop]};\n`;
        }
      }
      rules_code += `}`;
      return rules_code;
    }
  </script>
</head>
<body>
  <h1>JavaScript Examples</h1>
  <p>A few JavaScript examples</p>
  <hr />
  <div id="js_1">
    <button type="button" onclick="createTicTacToeTable('js_1')">Create table</button>
    <button type="button" onclick="resetTicTacToe('js_1')">Reset table</button>
    <!-- JavaScript example 1: TicTacToe game -->
    <p>TicTacToe board</p>
  </div>
  <hr />
  <div id="js_2">
    <button onclick="setup_css_form()">Setup CSS-form</button>
    <p>Interactive CSS style form</p>
    <p id="css_style">Change the text's appearance through a form.</p>
    <form id="css_form" action="">
      <label for="color">Text color</label>
      <input name="color" type="color">
      <label for="font-size">Font size</label>
      <input name="font-size" type="number" min="6" max="50" value="16">
      <label for="font-family">Font (family)</label>
      <input name="font-family" type="text">

<!--       <input type="submit" value="Change style"> -->
    </form>
    <button id="css_submit">Change Style</button>
    <p>Below are the rules for the CSS style</p>
    <code id="css_rules"></code>
  </div>
  <hr />
  <div id="js_3">
    <p>3</p>
  </div>
</body>
</html>
