<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <title>My page</title>
  <script src="example_1.js"></script>
  <script src="example_2.js"></script>
  <script>
    ////////////////////////
    // JavaScript example 3

    const game_state = {};
    const height = 25;
    const width = 25;
    
    function getAdjacent(x_idx, y_idx, x_idx_max, y_idx_max){
      if (x_idx_max != 0 && y_idx_max != 0){
        const adjacent = [];
        const x = [x_idx];
        const y = [y_idx];
        if (x_idx > 0){
          x.push(x_idx - 1);
        }
        if (x_idx < x_idx_max){
          x.push(x_idx + 1);
        }
        if (y_idx > 0){
          y.push(y_idx - 1);
        }
        if (y_idx < y_idx_max){
          y.push(y_idx + 1);
        }

        for (const x_coord of x){
          for (const y_coord of y){
            if (x_coord != x_idx || y_coord != y_idx){
              adjacent.push(`${x_coord}_${y_coord}`);
            }
          }
        }

        return adjacent;
      }
    }
    
    function checkAdjacent(adjacent){
      let adjacent_living = 0;
      for (const cell_id of adjacent){
        if (game_state[cell_id]){
          adjacent_living++;
        }
      }
      return adjacent_living;
    }

    function isAlive(currently_alive, adjacent_number){
      if (currently_alive){ return (adjacent_number > 1 && adjacent_number < 4); }
      else { return adjacent_number == 3; }
    }
    
    function advanceGOL(){
      const cellsToChange = [];
      for (const cell in game_state){
        const cell_coords = cell.split('_');
        if (game_state[cell] != isAlive(game_state[cell], checkAdjacent(getAdjacent(parseInt(cell_coords[0]), parseInt(cell_coords[1]), height - 1, width - 1)))){
          cellsToChange.push(cell);
        }
      }
      for (const cell of cellsToChange){
        game_state[cell] = !(game_state[cell]);
        const cell_el = document.getElementById(cell);
        if (cell_el.className == 'alive'){
          cell_el.className = 'dead';
        } else {
          cell_el.className = 'alive';
        }
      }
    }

    function changeCell(cell_id){
      game_state[cell_id] = !(game_state[cell_id]);
      const cell = document.getElementById(cell_id);
      if (cell.className == "alive"){
        cell.className = "dead";
      } else {
        cell.className = "alive";
      }
    }

    function handleCellClick(e){
      console.log("clicked " + e.target.id);
      changeCell(e.target.id);
    }

    function createBoard(el_id){
      if (document.getElementById("gol_board")){ return; }
      
      const board = document.createElement("table");
      board.id = "gol_board";
      
      for (let i = 0; i < height; i++){
        let row = document.createElement("tr");
        for (let j = 0; j < width; j++){
          let cell = document.createElement("td");
          cell.id = `${i}_${j}`;
          cell.className = "dead";
          row.appendChild(cell);
          cell.addEventListener("click", handleCellClick);
          game_state[`${i}_${j}`] = 0;
        }
        board.appendChild(row);
      }

      const gol_desc = document.createElement("p");
      gol_desc.innerHTML = "Click on the board to flip cells. Click the 'Advance' button to simulate a turn/cycle. Keep clicking to see how your setup turns out.";
      const container = document.getElementById(el_id);
      container.appendChild(gol_desc);
      container.appendChild(board);

      const advance_btn = document.createElement("button");
      advance_btn.innerHTML = "Advance";
      advance_btn.addEventListener("click", advanceGOL);
      container.appendChild(advance_btn);
    }
    
  </script>
</head>
<body>
  <h1>JavaScript Examples</h1>
  <p>A few JavaScript examples</p>
  <hr />
  <div id="js_1">
    <button type="button" onclick="create_TicTacToeTable('js_1')">Create table</button>
<!--     <button type="button" onclick="resetTicTacToe('tttTable')">Reset table</button> -->
    <!-- JavaScript example 1: TicTacToe game -->
    <p>TicTacToe board</p>
  </div>
  <hr />
  <div id="js_2">
    <button onclick="css.setup('js_2')">Setup CSS-form</button>
    <!-- JavaScript example 2: Interactive CSS -->
    <p>Interactive CSS style form</p>
    <p id="css_style">Change the appearance of this text through the options below.</p>
  </div>
  <hr />
  <div id="js_3">
    <p>Conway's 'Game Of Life'</p>
    <button onclick="createBoard('js_3')">Create 'Game Of Life' board</button>
  </div>
</body>
</html>
