<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <title>My page</title>
  <script>
    let playerTurn = 1;
    const players = ['O','X'];

    function getCellValue(id){
      return document.getElementById(id).innerHTML;
    }
    
    function checkWinCondition(player){
      let diagL = 0;
      let diagR = 0;
      for (let k = 0; k < 3; k++){
        if (getCellValue(`${k}_${k}`) == player){
          diagL++;
        }
        if (getCellValue(`${k}_${2 - k}`) == player){
          diagR++;
        }
      }
      
      if (diagL == 3 || diagR == 3){
        return true;
      }
      
      let horiz = 0;
      let vert = 0;
      for (let i = 0; i < 3; i++){
        for (let j = 0; j < 3; j++){
          if (getCellValue(`${i}_${j}`) == player){
            horiz++;
          }
          if (getCellValue(`${j}_${i}`) == player){
            vert++;
          }
        }
        
        if (horiz == 3 || vert == 3){
          return true;
        }
        horiz = 0;
        vert = 0;
      }
      
      return false;
    }
    
    function getPlayerTurn(){
      return players[playerTurn++ % 2];
    }
    function chooseCell(){
      if (this.innerHTML == ' '){
        this.innerHTML = getPlayerTurn();
        let curPlayer = this.innerHTML;
        if (checkWinCondition(curPlayer)){
          const gameStatusEl = document.getElementById("gameStatus");
          gameStatusEl.innerHTML = `Player ${player[playerTurn % 2]} won!`;
        }
      } else {
        
      }
    }
    function createTicTacToeTable(el_id){
      function returnTableCell(id){
        const tCell = document.createElement("td");
        tCell.id = id;
        tCell.onclick = chooseCell;
        tCell.innerHTML = ' ';
        return tCell;
      }
      function returnTableRow(i){
        const tRow = document.createElement("tr");
        for (let j = 0; j < 3; j++){
          // const tCell = returnTableCell();
          tRow.appendChild(returnTableCell(`${i}_${j}`));
        }
        return tRow;
      }
      let tableId = "tttTable";
      if (!document.getElementById(tableId)){
        const table = document.createElement("table");
        table.id = tableId;
        for (let i = 0; i < 3; i++){
          const tRow = returnTableRow(i);
          table.appendChild(tRow);
        }
        const tableContainer = document.getElementById(el_id);
        tableContainer.appendChild(table);

        const gameStatusEl = document.getElementById("gameStatus");
        gameStatusEl.innerHTML = `Player ${player[playerTurn % 2]}'s turn`;
      }
      if (document.getElementById("gameStatus").innerHTML){
        const gameStatusEl = document.getElementById("gameStatus");
        gameStatusEl.innerHTML = `Player ${player[playerTurn % 2]}'s turn`;
      }
    }

    // function checkCell(el){
    //   return;
    // }
    
    // function tictactoe(){
    //   let player = "X";
    //   let turn = 1;
    //   return;
    // }
  </script>
</head>
<body>
  <h1>Test</h1>
  <p>Hello world!</p>
  <button type="button" onclick="createTicTacToeTable('js_1')">Create table</button>
  <div id="js_1">
    <p>TicTacToe board</p>
    <p id="gameStatus"></p>
  </div>
  <hr />
  <div id="js_2">
    <p>2</p>
  </div>
  <hr />
  <div id="js_3">
    <p>3</p>
  </div>
</body>
</html>
